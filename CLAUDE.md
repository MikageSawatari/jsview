# JSON Lines Pretty Printer

## プロジェクト概要
JSON Lines（JSONL）形式のデータを整形して見やすく表示するWebツールです。
複数行のJSONデータを個別にパースし、インデント付きで表示します。

## 作業の進め方

- TODO項目を1つずつ作成し、できたらユーザに確認してください。
- 仕様が曖昧な部分、実装上で迷う部分があったら、ユーザに確認してください。

## 技術スタック
- HTML5
- CSS3
- Vanilla JavaScript

## ファイル構成
```
jsview/
├── index.html    # メインHTMLファイル
├── style.css     # スタイルシート
├── script.js     # JavaScript（整形ロジック）
├── CLAUDE.md     # プロジェクト情報
└── test/         # テストデータ
    ├── test1_long_strings.jsonl      # 長い文字列を含むテストデータ
    ├── test2_long_arrays.jsonl       # 長い配列を含むテストデータ
    ├── test3_arrays_with_objects.jsonl   # オブジェクトを含む配列のテストデータ
    ├── test4_arrays_with_long_strings.jsonl  # 長い文字列を含む配列のテストデータ
    └── test5_nested_complex.jsonl    # 複雑にネストされたテストデータ
```

## 主な機能
1. **タブインターフェース**
   - 入力タブとテーブルタブの切り替え機能
   - 整形成功時に自動でテーブルタブに切り替え

2. **JSON Lines の入力と検証**
   - 複数行のJSON形式データを個別にパース
   - 無効なJSON形式の場合、アラートでエラーメッセージを表示
   - Ctrl+Enterショートカットで整形実行

3. **テーブル表示**
   - JSONデータを表形式で表示
   - ネストされたキーは「.」区切りで表現
   - オブジェクト値は非表示（子要素のみ表示）
   - 存在しないキーは空欄で表示
   - 30文字を超える文字列は省略表示（クリックで全文表示）

4. **JSONダイアログ表示**
   - テーブル行をクリックでモーダルダイアログ表示（画面の94%使用）
   - 構文ハイライト付きのPretty Print
   - indent-rainbow風の色付きインデントガイド（括弧の右側に配置）
   - ESCキー、×ボタン、背景クリックで閉じる
   - 長い文字列の省略表示と詳細ダイアログ
   - オブジェクトの折りたたみ/展開機能
   - 配列の省略表示（4要素以上）と展開機能

5. **高度な表示機能**
   - 30文字を超える文字列を省略表示、クリックで詳細ダイアログ表示
   - 文字列詳細ダイアログ（画面の88%使用）にコピーボタン付き
   - オブジェクトキーの{右側に▼/▶ボタンで折りたたみ/展開
   - 4要素以上の配列は最初の3要素のみ表示、「…（他N要素）」クリックで全表示
   - 配列内のオブジェクトにも展開ボタンを表示

6. **列の非表示/再表示機能**
   - 各列のヘッダに赤い×ボタンを表示（ホバーで表示）
   - ×ボタンクリックで列を非表示（親列の場合は子列も連動）
   - 子列がすべて非表示になると親列も自動的に非表示
   - タブバーの右側に＋ボタンを表示（テーブルタブ選択時のみ）
   - ＋ボタンクリックで非表示列のメニューを表示
   - メニューから列を選択して再表示可能

7. **スクロール機能**
   - 画面下部に横スクロールバーを固定表示（テーブルが画面幅を超える場合）
   - テーブル本体のスクロールと同期
   - ヘッダは上部に固定（複数行ヘッダもサポート）
   - 左右端にホバーで表示されるスクロールボタン（◀▶）
   - クリックで画面幅の半分をスムーズスクロール

8. **値の存在率表示**
   - 各列の最下層ヘッダセルに存在率インジケーターを表示
   - 10個のドットで10%刻みの視覚的表現
   - 緑色（#4CAF50）で値の存在を、グレー（#e0e0e0）で不在を表示
   - ホバー時にツールチップで正確なパーセンテージを表示

9. **ヘッダクリックでソート機能**
   - データ列（リーフノード）のヘッダをクリックでソート
   - 降順→昇順→ソートなしの順で切り替え
   - ソート中の列に緑色背景の↓（降順）または↑（昇順）アイコンを表示
   - null/undefined/空文字列は常に最後にソート
   - 数値と文字列が混在する場合、数値を前に表示
   - ソート時も横スクロール位置を保持

10. **検索機能**
   - テーブルタブの右上に検索ボックスを配置
   - リアルタイム検索（300ms のデバウンス処理）
   - スペース区切りで AND 検索
   - セミコロン（;）区切りで OR 検索
   - すべての値（文字列、数値、配列、オブジェクト）を再帰的に検索
   - 大文字小文字を区別しない部分一致検索
   - 検索結果件数をツールチップで表示
   - 検索結果が0件の場合は専用メッセージを表示
   - 検索中もソート状態を維持

## 使用方法
1. 入力タブでJSON Lines形式のデータを入力
2. 「整形」ボタンをクリック（またはCtrl+Enter）
3. エラーがなければ自動的にテーブルタブに切り替わり、データが表形式で表示
4. テーブルの行をクリックすると、その行のJSONデータがダイアログで表示
5. データを変更する場合は入力タブに戻り、クリアボタンで初期化

## 入力例
```
{"name": "mikage", "age": 12, "score": {"game": 100, "english": 50}}
{"name": "tomomi", "email": "test@example.com", "score": {"game": 80, "english": 90}}
```

## 実装済み機能

- ✅ タブ機能（入力/テーブル）を実装
- ✅ JSONデータをテーブル形式で表示する機能を実装
- ✅ テーブル行クリックでJSONダイアログを表示
- ✅ ダイアログでindent-rainbow風の色付けを実装
- ✅ ダイアログのサイズを画面全体に近い大きさに変更（94%使用、3%余白）
- ✅ 30文字以上の文字列を省略表示し、クリックで全体表示
- ✅ オブジェクトのキーをクリックで折りたたみ/展開
- ✅ 配列で4要素以上の場合に省略表示
- ✅ テーブル表示でも長い文字列を短縮表示
- ✅ array内のobjectに展開ボタンを表示
- ✅ テーブルヘッダの階層化（colspan/rowspanを使用）
- ✅ 混在型キーの表示順序を修正（空文字列を最初に表示）
- ✅ 列の非表示/再表示機能（×ボタンと＋ボタン）
- ✅ 親列の非表示で子列も連動して非表示
- ✅ 子列がすべて非表示になると親列も自動非表示
- ✅ 画面下部に横スクロールバーを固定表示
- ✅ 左右スクロールボタン（ホバーで表示）
- ✅ ブラウザの戻る/進むボタン対応（History API）
- ✅ 列ごとの値の存在率を視覚的に表示
- ✅ ヘッダクリックでソート機能（降順→昇順→ソートなし）
- ✅ ソート時のnull/undefined/空文字列の扱い（常に最後）
- ✅ 数値と文字列の混在時の適切なソート
- ✅ ソートアイコンの表示（緑色の背景付き）
- ✅ ソート時の横スクロール位置保持
- ✅ 検索ボックスの実装（テーブルタブ右上）
- ✅ AND/OR検索対応（スペース区切りでAND、セミコロン区切りでOR）
- ✅ リアルタイム検索（デバウンス処理付き）
- ✅ 検索結果のフィルタリングと件数表示
- ✅ 検索とソートの組み合わせ対応


## 画面構成

- 画面上部に、[入力|テーブル]のタブを追加し、初期は入力タブとする
- データを入力し、整形ボタンを押すと、テーブルタブに移動し、結果をテーブル表示する
- テーブルの行をクリックすると、その行のJSONをダイアログ表示する。

### テーブル表示

- JSONの各キーを列方向に並べて表形式で表示する
- object は表示しない（下の階層でのみ値を表示する）
- キーの値がすべてobjectである場合、そのキーの列自体を表示しない
- ネストされたキーは、「.」区切りで階層表現する
- キーが存在しないセルは空欄とする。
- 同じキー名に、異なる型が混在することがあるが許容する。

#### 入力例
```
{"name": "mikage", "age": 12, "score": {"game": 100, "english": 50}}
{"name": "tomomi", "email": "test@example.com", "score": {"game": 80, "english": 90}}
```
#### テーブル表示例

| name | age | email | score.game | score.english |
| ---- | --- | ----- | ---------- | ------------- |
| mikage | 12 |  | 100 | 50 |
| tomomi |  | test@example.com | 80 | 90 |

## ダイアログ表示

- 選択された行の1要素のJSONを Pretty Print する
- 構文ハイライト：
  - キー名：青色（#0451a5）
  - 文字列・数値：緑色（#098658）
  - ブール値・null：青色（#0000ff）
  - 括弧：グレー（#666）
- インデントは2スペースで、indent-rainbow のように色を付ける：
  - 各インデントレベルごとに色付きの縦線を表示
  - レベル1：赤（#ff6b6b）
  - レベル2：シアン（#4ecdc4）
  - レベル3：青（#45b7d1）
  - レベル4：緑（#96ceb4）
  - レベル5：黄色（#ffeaa7）
  - レベル6：グレー（#dfe6e9）
  - 縦線は括弧の文字幅の中央に配置

## 開発環境での実行
単純なHTMLファイルなので、`index.html`をブラウザで開くだけで動作します。
ローカルサーバーは不要です。

## ブラウザサポート
モダンブラウザ（Chrome、Firefox、Safari、Edge）で動作確認済み。